<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="alternate"
      type="application/rss+xml"
      href="https://bastibe.de/rss.xml"
      title="RSS feed for https://bastibe.de/"/>
<title>Bastibe.de</title>
<meta name="author" content="Bastian Bechtold">
<meta name="referrer" content="no-referrer">
<link href= "static/style.css" rel="stylesheet" type="text/css" />
<link rel="icon" href="static/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="static/favicon-152.png">
<link rel="msapplication-TitleImage" href="static/favicon-144.png">
<link rel="msapplication-TitleColor" href="#0141ff">
<script src="static/katex.min.js"></script>
<script src="static/auto-render.min.js"></script>
<link rel="stylesheet" href="static/katex.min.css">
<script>document.addEventListener("DOMContentLoaded", function() { renderMathInElement(document.body); });</script>
<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8">
<meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1"></head>
<body>
<div id="preamble" class="status"><div class="header">
  <a href="https://bastibe.de">Basti's Scratchpad on the Internet</a>
  <div class="sitelinks">
    <a href="https://twitter.com/paperflyer">Twitter</a> | <a href="https://github.com/bastibe">Github</a> | <a href="https://bastibe.de/projects.html">Projects</a>
  </div>
</div></div>
<div id="content">

<div class="post-date">08 Nov 2018</div><h1 class="post-title"><a href="2018-11-08-cool-python-libraries.html">Cool Python Libraries: TQDM and Resampy</a></h1>
<p>
In my recent post about <a href="https://bastibe.de/2018-10-14-appreciation-for-open-source-and-commercial-software.html">appreciation for open source software</a>, I mentioned that we should praise our open source heros more often. So here are two lesser-known libraries that I use daily, and which are unabashedly awesome:
</p>

<div id="outline-container-org396ee7f" class="outline-2">
<h2 id="org396ee7f"><a href="https://tqdm.github.io/">TQDM</a></h2>
<div class="outline-text-2" id="text-org396ee7f">
<p>
TQDM draws text progress bars for long-running processes, simply by wrapping your iterator in <code>tqdm(iterator)</code>. And this, alone, would be awesome. But, TQDM is one of those libraries that aren't just a good idea, but then go the extra mile, and add fantastic documentation, contingencies for all kinds of weird use cases, and integration with notebooks and GUIs.
</p>

<p>
I use TQDM all the time, for running my scientific experiments and data analysis, and it just works. For long-running tasks, I recommend using <code>tqdm(iterator, smoothing=0, desc='calculating')</code>, which adds a meaningful description to the progress bar, and an accurate runtime estimate.
</p>
</div>
</div>

<div id="outline-container-org53adbd0" class="outline-2">
<h2 id="org53adbd0"><a href="https://resampy.readthedocs.io/en/latest/">Resampy</a></h2>
<div class="outline-text-2" id="text-org53adbd0">
<p>
Resampy resamples numpy signals. Resample your data with <code>resample(signal, old_samplerate, new_samplerate)</code>. Just like with TQDM, this simple interface hides a lot of complexity and flexibility under the hood, yet remains conceptually simple and easy to use.
</p>

<p>
But beyond simplicity, resampy uses a clever implementation that is a far cry better than <code>scipy.signal.resample</code>, while still being easy to install and fast. For a more thorough comparison of resampling algorithms, visit <a href="https://signalsprocessed.blogspot.com/2016/08/audio-resampling-in-python.html">Joachim Thiemann's blog</a>.
</p>
</div>
</div>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-python.html">python</a> </div>
<div class="post-date">26 Oct 2018</div><h1 class="post-title"><a href="2018-10-26-dealing-with-unreliable-software.html">Dealing with Unreliable Software</a></h1>
<p>
About a year ago, I started working on a big comparison study between a bunch of scientific algorithms. Many of these have open-source software available, and I wanted to evaluate them with a large variety of input signals. The problem is, this is <a href="https://bastibe.de/2017-05-14-scientific-code.html">scientific code</a>, i.e. the worst code imaginable.
</p>

<p>
Things this code has done to my computer:
</p>
<ul class="org-ul">
<li>it crashed, throwing an error, and shutting down nicely</li>
<li>it crashed with a segfault, taking the owning process with it</li>
<li>it crashed, leaving temporary files lying around</li>
<li>it crashed, leaving zombie processes lying around</li>
<li>it spin-locked, and never returned</li>
<li>it spin-locked, and forked uncontrollably until all process decriptors were exhausted</li>
<li>it spin-locked, and ate memory uncontrollably until all memory was consumed</li>
<li>it crashed other, unrelated programs (no idea how it managed that)</li>
<li>it corrupted the root file system (no idea how it managed that)</li>
</ul>

<p>
Note that the code did not do any of this intentionally. It was merely code written by non-expert programmers, the problems often a side effect of performance optimizations. The code mostly works fine if called only once or twice. My problems only become apparent if I ran it, say, a few hundred thousand times, with dozens of processes in parallel.
</p>

<p>
So, how do you deal with this? Multi-threading is not an option, since a segfault would kill the whole program. So it has to be multi-processing. But all the multi-processing frameworks I know will lose all progress if one of the more sinister scenarios from the above list hard-crashed one or more of its processes. I needed a more robust solution.
</p>

<p>
Basically, the only hope of survival at this point is the kernel. Only the kernel has enough power to rein in rogue processes, and deal with hard crashes. So in my <a href="https://github.com/bastibe/runforrest">purpose-built multi-processing framework</a>, every task runs in its own process, with inputs and outputs written to unique files. And crucially, if any task does not finish within a set amount of time, it and all of its children are killed.
</p>

<p>
It took me quite a while to figure out how to do this, so here's the deal:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #111111; font-style: italic;"># </span><span style="color: #111111; font-style: italic;">start your process with a new process group:</span>
<span style="color: #111111;">process</span> = Popen(..., start_new_session=<span style="color: #111111;">True</span>)

<span style="color: #111111; font-style: italic;"># </span><span style="color: #111111; font-style: italic;">after a timeout, kill the whole process group:</span>
<span style="color: #111111;">process_group_id</span> = os.getpgid(process.pid)
os.killpg(process_group_id, signal.SIGKILL)
</pre>
</div>

<p>
This is the nuclear option. I tried <code>SIGTERM</code> and <code>SIGHUP</code> instead, but programs would happily ignore it. I tried killing or terminating only the <code>process</code>, but that would leave zombie children. Sending <code>SIGKILL</code> to the process group does not take prisoners. The processes do not get a chance to respond or clean up after themselves. But you know what, after months of dealing with this stuff, this is the first time that my experiments actually run reliably for a few days without crashing or exhausting some resource. If that's what it takes, so be it.
</p>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-programming.html">programming</a> </div>
<div class="post-date">14 Oct 2018</div><h1 class="post-title"><a href="2018-10-14-appreciation-for-open-source-and-commercial-software.html">Appreciation for Open Source and Commercial Software</a></h1>
<p>
I recently released my first-ever piece of commercial software, a <a href="https://missiongenerator.eu/">plugin</a> for the <a href="https://www.x-plane.com/">X-Plane</a> flight simulator. I wrote this primarily to scratch my own itch, but thought other users might like it, too, so I put it up on <a href="https://store.x-plane.org/Mission-Generator_p_877.html">the store</a>. What struck me however, were the stark difference between the kinds of responses I got to this, as compared to my open source projects: They were astonishingly, resoundingly, <i>positive</i>!
</p>

<p>
You see, I have a bunch of open source projects, with a few thousand downloads per month, and a dozen or so issues on Github per week. Most of my interactions with my users are utilitarian, and efficient. Someone reports a bug or asks for help, I ask for clarification or a pull request, we iterate a few times until the issue is resolved. The process is mechanical and the tone of our conversation is equally unemotional. This is as it should be.
</p>

<p>
After having released my flight simulator plugin, however, people <i>thanked me</i>! They <i>congratulated me</i>! They extolled about the greatness of what I had built! And they did this despite the fact that the initial release had quite a few major bugs, and even flat-out did not work for some people. Yet even people who couldn't get it to work were <i>grateful</i> for my help in resolving their issue!
</p>

<p>
This <i>blew my mind</i>, in comparison with the drab "I found a bug", "Could you implement…" I was used to from my open source work. There, the feedback I got was mostly neutral (bug reports, feature requests), and sometimes even negative ("You broke something!"). So I release my software <i>for free</i>, as a gift, and get average-negative feedback. My commercial work, in contrast, <i>costs money</i>, and yet the feedback I get is resoundingly positive! I can not overstate how motivating it is to get praise, and love, from my users.
</p>

<p>
I think this is a huge problem for our Open Source community. I had my run-ins with burnout, when all the pull requests came to be too much, and I started dreading the little notification icon on Github. And I think the negativity inherent in bug reports and feature requests has a huge part to do with this. In the future, I will try to add more praise to my bug reports from now on, just to put things into perspective.
</p>

<p>
But I think we should go further than that. We should create tools for praising stuff, beyond the impersonal Stars on Github. We should be able to write reviews on Github, and recommendations, and blog posts about cool libraries we find.
</p>

<p>
I recently got my first github issue that was <a href="https://github.com/bastibe/org-static-blog/issues/12">just a thank-you note</a>. I loved it! We need more positivity like that.
</p>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-open-source.html">open-source</a> <a href="tag-thank-you.html">thank-you</a> </div>
<div class="post-date">03 Jun 2018</div><h1 class="post-title"><a href="2018-06-03-syncing-org-journal-with-your-calendar.html">Syncing Org-Journal with your Calendar</a></h1>
<p>
<a href="https://bastibe.de/2018-04-02-scheduling-future-todos-in-org-journal.html">A month ago</a>, org-journal learned to deal with future journal entries. I use future journal entries for appointments or not-yet-actionable tasks that I don't want in my current TODO list just yet. This works really well while I am at my computer, and really does not work at all when I am not (<a href="http://www.orgzly.com/">Orgzly</a> does <i>not</i> work with my 1k-file journal directory).
</p>

<p>
But, as I keep re-discovering, org-mode already has a solution for this: org-mode can export your agenda to an iCalendar file! Most calendar applications can then subscribe to that file, and show your future journal entries right in your calendar. And if you set it up right, this will even sync changes to your calendar!
</p>

<p>
First, you need to set up some kind of regular export job. I use a cron job that regularly runs an Emacs batch job <code>emacs --batch --script ~/bin/calendar_init.el</code> with the following code in <i>calendar​_init.el</i>:
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #111111; font-style: italic;">;; </span><span style="color: #111111; font-style: italic;">no init file is loaded, so provide everything here:</span>
(add-to-list 'load-path <span style="color: #303030;">"~/etc/org-journal/"</span>)
(<span style="color: #111111; font-weight: bold;">setq</span> org-journal-dir <span style="color: #303030;">"~/journal/"</span>            <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">where my journal files are</span>
      org-journal-file-format <span style="color: #303030;">"%Y-%m-%d.org"</span>  <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">their file names</span>
      org-journal-enable-agenda-integration t <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">so entries are on the agenda</span>
      org-icalendar-store-UID t               <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">so changes sync correctly</span>
      org-icalendar-include-todo <span style="color: #303030;">"all"</span>        <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">include TODOs and DONEs</span>
      org-icalendar-combined-agenda-file <span style="color: #303030;">"~/calendar/org-journal.ics"</span>)

(<span style="color: #111111; font-weight: bold;">require</span> '<span style="color: #111111;">org-journal</span>)
(org-journal-update-org-agenda-files) <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">put future entries on the agenda</span>
(org-icalendar-combine-agenda-files)  <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">export the ICS file</span>
(save-buffers-kill-emacs t)           <span style="color: #111111; font-style: italic;">; </span><span style="color: #111111; font-style: italic;">save all modified files and exit</span>
</pre>
</div>

<p>
It is important to set <code>org-icalendar-store-UID</code>, as otherwise every change to a future entry would result in a duplicated calendar entry. It will clutter up your journal entries with an <code>UID</code> property, though.
</p>

<p>
I do this on my web server, with my journal files <a href="https://syncthing.net/">syncthing</a>ed from my other computers. With that, I can subscribe to the calendar file from any internet-connected computer or mobile phone (using <a href="https://icsdroid.bitfire.at/">ICSdroid</a>). But you could just as well sync only the ICS file, or just subscribe to the local file, if you don't want to upload your complete yournal to a web server.
</p>

<p>
(Incidentally, I first implemented my own ICS export, before realizing that this functionality already existed in org-mode. It was a fun little project, and I learned a lot about org-mode's internal data structures and the weirdness that are iCalendar files.)
</p>
<div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-org-journal.html">org-journal</a> </div>
<div class="post-date">25 May 2018</div><h1 class="post-title"><a href="2018-05-25-gdpr-compliance.html">GDPR Compliance</a></h1>
<p>
Personal email is dead. The signal-to-noise ratio of my personal email account has been deeply negative for years. But the last few days have been especially riveting, with a torrent of GDPR-compliance emails from just about every company that has ever gotten their hands on my email address. Anecdotally, if spam makes up about 90% of all email traffic, and the last few days have seen a ten-fold increase in traffic due to GDPR emails, we might even have "defeated spam" for a few days! Yay internet!
</p>

<p>
But sadly, I can't add to the signal-to-noise ratio, because this website does not collect any email addresses. And even more sadly, it doesn't even collect IP addresses, or use any kind of analytics at all. Sorry about that. I honestly do not know how many people read my stuff, and I can not rank my blog posts by their popularity. And I like it that way. It prevents me from getting on any kind of treadmill to please any kind of imagined audience.
</p>

<p>
That is&#x2026; with one exception: Comments on this website are powered by Disqus, and I'm sure Disqus collects all kinds of data about all kinds of things. That's why comments are now hidden behind a "Load Disqus Comments" button. I promise you that no foreign Javascript is executed unless you press that button<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>. And honestly, GDPR didn't even have anything to do with that. I just didn't want any foreign JavaScript.
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
Unless <a href="https://github.com/Khan/KaTeX">katex.min.js</a> somehow is loading external javascript&#x2026;
</p></div></div>


</div>
</div><div class="taglist"><a href="tags.html">Tags:</a> <a href="tag-privacy.html">privacy</a> <a href="tag-blog.html">blog</a> </div><div id="archive">
<a href="archive.html">Other posts</a>
</div>
</div>
</body>
</html>
